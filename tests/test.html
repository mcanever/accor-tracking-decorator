<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>

    <script>
        var pageNameFromPhp = 'test1';
        var icl_vars = {current_language: 'en'};

        /*
        * Current version:
        *
        * if (.. cookie accepted ..) {
        *
        *     dataLayer.push({
        *        pagename: 'corporate::' + pageNameFromPhp,
        *        pagelanguage: icl_vars.current_language,
        *        category: 'corporate',
        *        sub_category_level1: pageNameFromPhp,
        *        event: 'push_dynamic_datas'
        *    });
        * }
        *
        * */

        //New version:
        // if (.. cookie accepted ..) {
        var sendDataLayerObj = function() {
            var dataLayerObject =  {
                pagename: 'corporate::' + pageNameFromPhp,
                pagelanguage: icl_vars.current_language,
                category: 'corporate',
                sub_category_level1: pageNameFromPhp,
                event: 'push_dynamic_datas'
            };
            var trackingVars = _JoAndJoeTrackingDecorator.getDataLayerVars();
            // Append tracking vars to the original Object
            for (var key in trackingVars) {
                if (trackingVars.hasOwnProperty(key)) {
                    dataLayerObject[key] = trackingVars[key];
                }
            }
            // window.console && console.log('pushing DataLayer Object', dataLayerObject);
            dataLayer.push(dataLayerObject);
        };
        // }

        if (typeof _JoAndJoeTrackingDecorator !== 'undefined'
            && typeof _JoAndJoeTrackingDecorator.getDataLayerVars !== 'undefined'
        ) {
            sendDataLayerObj();
        } else {
            document.addEventListener('accor_tracking_params_available', sendDataLayerObj);
        }
    </script>

    <!-- Decorator library -->
    <script src="../decorator.js" async></script>

    <!-- Decorator configuration -->
    <script>
        var _JoAndJoeTrackingDecorator = _JoAndJoeTrackingDecorator || {};
        _JoAndJoeTrackingDecorator.config = {
            autoDecorate: true,
            handleGoogleAnalytics: true,
            debug: true,

            // This parameter is OPTIONAL!
            paramsToPropagate: [
                'utm_source',
                'utm_content',
                'utm_term',
                'utm_medium',
                'utm_campaign',
                'utm_sourceid',
                'sourceid',
                'merchantid',
                'sourcid'
            ],

            // This parameter is OPTIONAL!
            dataLayerVars: {
                 merchantid: 'merchantid',
                 sourceid: 'sourceid',
            }
        };
    </script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-70971972-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-70971972-1');
    </script>
    <style>
        html, body {font-family: Arial, Helvetica, sans-serif; color: #333;}
        main {width: 90%; max-width: 1200px; margin: 50px auto;}
    </style>
</head>
<body>
    <main>
        <h1>JoAndJoeTrackingDecorator test</h1>
        <p>
            Autodecorated links
        </p>
        <script>
            function testDecorateObject() {
                var obj={ param: 'value' };
                // Call the decorator
                var decorated = _JoAndJoeTrackingDecorator.decorateObject({ param: 'value' });

                //////
                var msg = "Before: \r\n" + JSON.stringify(obj, null, 2);
                msg += "\r\n\r\nAfter: \r\n" + JSON.stringify(decorated, null, 2);

                alert(msg);
            }
        </script>
        <ul>
            <li><a target="_blank" href="https://www.secure-hotel-booking.com/smart/JO-JOE-Paris-Gentilly/2QKR/en/">https://www.secure-hotel-booking.com/smart/JO-JOE-Paris-Gentilly/2QKR/en/</a></li>
            <li><a target="_blank" href="https://all.accor.com#Hash">Hash test</a></li>
            <li><button onclick="testDecorateObject();">Decorate Object</button></li>
        </ul>

        <h2>View Source to check the implementation</h2>
    </main>
</body>
</html>
